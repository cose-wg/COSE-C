platform:
  - x64

image: Visual Studio 2017
  
configuration:
  - Release
#  - Debug   suppress this for now

environment:
  matrix:
    - USE_CONTEXT: ON      
      USE_MBEDTLS: OFF

    - USE_CONTEXT: OFF
      USE_MBEDTLS: OFF

    - USE_CONTEXT: OFF
      USE_MBEDTLS: ON

matrix:
  fast_finish: true

install:
  # get test data
  - git submodule update --init --recursive
  - git clone --depth 1 git://github.com/cose-wg/Examples Examples
  
  # get mbedtls
  - rm -rf mbedtls
  - git clone --depth=1 --recurse-submodules git://github.com/ARMmbed/mbedtls mbedtls
  - cd mbedtls
  - mkdir build
  - cd build
  - cmake .. -DENABLE_PROGRAMS=OFF -DENABLE_TESTING=OFF
  - cmake --build .
  - cmake --build . --target install
  - cd ../..

before_build:
  - cmake --version
  - mkdir build && cd build
  - cmake -DCOSE_C_USE_CONTEXT=%USE_CONTEXT% -DCOSE_C_USE_MBEDTLS=%USE_MBEDTLS% -DCOSE_C_FATAL_WARNINGS=OFF -DCMAKE_BUILD_TYPE=%CONFIGURATION% ..

build_script:
  - cmake --build .
  - ctest -C %CONFIGURATION%
